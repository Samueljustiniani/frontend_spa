<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="material-icons me-2" style="vertical-align: middle;">inventory_2</i>Productos</h5>
        <a routerLink="new" class="btn btn-primary btn-sm">
          <i class="material-icons me-1" style="font-size: 18px; vertical-align: middle;">add</i>Nuevo Producto
        </a>
      </div>
      <div class="card-body">
        <!-- Filters Row -->
        <div class="row mb-3 g-2">
          <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Buscar producto..." 
                   [(ngModel)]="searchTerm">
          </div>
          <div class="col-md-4">
            <div class="btn-group w-100" role="group">
              <button type="button" class="btn" 
                      [class]="statusFilter === '' ? 'btn-primary' : 'btn-outline-primary'"
                      (click)="statusFilter = ''; onFilterChange()">
                Todos
              </button>
              <button type="button" class="btn" 
                      [class]="statusFilter === 'A' ? 'btn-success' : 'btn-outline-success'"
                      (click)="statusFilter = 'A'; onFilterChange()">
                Activos
              </button>
              <button type="button" class="btn" 
                      [class]="statusFilter === 'I' ? 'btn-secondary' : 'btn-outline-secondary'"
                      (click)="statusFilter = 'I'; onFilterChange()">
                Inactivos
              </button>
            </div>
          </div>
        </div>

        <!-- Loading -->
        <div *ngIf="loading" class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="!loading && errorMsg" class="alert alert-danger text-center" role="alert">
          {{ errorMsg }}
          <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadProducts()">Reintentar</button>
        </div>

        <!-- Table -->
        <div class="table-responsive" *ngIf="!loading && !errorMsg">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Imagen</th>
                <th>Nombre</th>
                <th class="d-none d-md-table-cell">Descripción</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Estado</th>
                <th class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of filteredProducts">
                <td data-label="ID">{{ product.id }}</td>
                <td data-label="Imagen">
                  <img *ngIf="product.imageUrl" [src]="product.imageUrl" 
                       alt="{{ product.name }}" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">
                  <span *ngIf="!product.imageUrl" class="badge bg-secondary">Sin imagen</span>
                </td>
                <td data-label="Nombre"><strong>{{ product.name }}</strong></td>
                <td data-label="Descripción" class="d-none d-md-table-cell">{{ product.description | slice:0:50 }}{{ product.description.length > 50 ? '...' : '' }}</td>
                <td data-label="Precio" class="text-success fw-bold">S/. {{ product.price | number:'1.2-2' }}</td>
                <td data-label="Stock">
                  <span [class]="product.stock > 10 ? 'badge bg-success' : product.stock > 0 ? 'badge bg-warning' : 'badge bg-danger'">
                    {{ product.stock }}
                  </span>
                </td>
                <td data-label="Estado">
                  <span [class]="product.status === 'A' ? 'badge bg-success' : 'badge bg-secondary'">
                    {{ product.status === 'A' ? 'Activo' : 'Inactivo' }}
                  </span>
                </td>
                <td class="text-center" data-label="">
                  <button *ngIf="product.imageUrl" (click)="viewImage(product)" class="btn btn-outline-info btn-sm me-1" title="Ver imagen">
                    <i class="material-icons" style="font-size: 18px; vertical-align: middle;">visibility</i>
                  </button>
                  <a [routerLink]="[product.id, 'edit']" class="btn btn-outline-primary btn-sm me-1" title="Editar">
                    <i class="material-icons" style="font-size: 18px; vertical-align: middle;">edit</i>
                  </a>
                  <button (click)="deleteProduct(product.id)" class="btn btn-outline-danger btn-sm" title="Eliminar">
                    <i class="material-icons" style="font-size: 18px; vertical-align: middle;">delete</i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="filteredProducts.length === 0">
                <td colspan="8" class="text-center text-muted py-4">
                  No se encontraron productos
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para ver imagen -->
<div class="modal fade" [class.show]="showImageModal" [style.display]="showImageModal ? 'block' : 'none'"
     tabindex="-1" (click)="closeImageModal()">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5 class="modal-title">{{ selectedImageName }}</h5>
        <button type="button" class="btn-close" (click)="closeImageModal()"></button>
      </div>
      <div class="modal-body text-center p-0">
        <img [src]="selectedImageUrl" [alt]="selectedImageName" class="img-fluid">
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="showImageModal" *ngIf="showImageModal"></div>